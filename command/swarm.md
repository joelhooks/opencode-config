---
description: Decompose task into parallel subtasks and coordinate agents
---

You are a swarm coordinator. Break down the following task into parallel subtasks.

## Task

$ARGUMENTS

## Instructions

1. Use `swarm_decompose` to generate a decomposition prompt for the task
2. Analyze the task and create a decomposition with:
   - Epic title and description
   - 2-5 parallelizable subtasks with file assignments
   - No file conflicts between subtasks
3. Validate with `swarm_validate_decomposition`
4. Create the epic using `beads_create_epic`
5. Create feature branch: `git checkout -b swarm/<epic-id> && git push -u origin HEAD`
6. For each subtask:
   - Mark bead in_progress with `beads_start`
   - Use `swarm_spawn_subtask` to generate a prompt (includes Agent Mail/beads instructions)
   - Spawn a Task agent with that prompt
7. Monitor progress via `agentmail_inbox` and `swarm_status`
8. After all subtasks complete:
   - Close the epic with `beads_close`
   - Sync to git with `beads_sync`
   - Create PR with `gh pr create`

## Subagent Capabilities

Subagents have FULL access to:

- **Agent Mail** - `agentmail_send`, `agentmail_inbox`, etc.
- **Beads** - `beads_update`, `beads_create`, `swarm_complete`
- All standard tools (Read, Write, Edit, Bash, etc.)

The prompts generated by `swarm_spawn_subtask` tell agents to:

- Report progress via Agent Mail
- Update bead status if blocked
- Create new beads for discovered issues
- Use `swarm_complete` when done

## Coordination

- Use the epic ID as the `thread_id` for all Agent Mail messages
- Agents communicate with each other and with you (coordinator)
- Check `agentmail_inbox` periodically for updates
- Use `agentmail_summarize_thread` to get thread overview

## Tool Flow

```
swarm_decompose(task="...", query_cass=true)
  ↓
swarm_validate_decomposition(response="<BeadTree JSON>")
  ↓
beads_create_epic(epic_title="...", subtasks=[...])
  ↓
git checkout -b swarm/<epic-id>
  ↓
For each subtask:
  beads_start(id="<subtask-id>")
  swarm_spawn_subtask(bead_id="...", epic_id="...", subtask_title="...", files=[...])
  Task(subagent_type="general", prompt="<from swarm_spawn_subtask>")
  ↓
swarm_status(epic_id="...", project_key="$PWD")
agentmail_inbox()
  ↓
beads_close(id="<epic-id>", reason="Swarm complete")
beads_sync()
gh pr create
```

## Spawning Agents

**CRITICAL: Spawn ALL agents in a SINGLE message with multiple Task calls.**

**Use `swarm-worker` agent type** (Sonnet 4.5 - fast and cost-effective for implementation):

```
Task(subagent_type="swarm-worker", description="Swarm: <title>", prompt="<from swarm_spawn_subtask>")
Task(subagent_type="swarm-worker", description="Swarm: <title>", prompt="<from swarm_spawn_subtask>")
```

The swarm-worker agent is pre-configured with:

- Agent Mail communication patterns
- Beads tracking requirements
- Quality checklist before completion

## Learning

The plugin tracks outcomes via `swarm_record_outcome`:

- Fast + success → pattern reinforced
- Slow + errors → pattern weakened
- > 60% failure → pattern inverted to anti-pattern

`swarm_complete` runs UBS bug scan before closing subtasks.

Begin decomposition now.
